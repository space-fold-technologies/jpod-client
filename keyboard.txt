#include <stdio.h>
#include <termios.h>
#include <unistd.h>

void setNonCanonicalMode () {
  struct termios term;
  tcgetattr (STDIN_FILENO, &term); // get the original state
  term.c_lflag &= ~ (ICANON | ECHO); // echo off, canonical mode off
  tcsetattr (STDIN_FILENO, TCSANOW, &term); // set the new state
}

void resetCanonicalMode () {
  struct termios term;
  tcgetattr (STDIN_FILENO, &term); // get the current state
  term.c_lflag |= ICANON | ECHO; // echo on, canonical mode on
  tcsetattr (STDIN_FILENO, TCSANOW, &term); // set the original state
}

int main () {
  char c;
  setNonCanonicalMode (); // switch to non-canonical mode
  while (1) {
    read (STDIN_FILENO, &c, 1); // read one character at a time
    if (c == 'q') break; // quit if 'q' is pressed
    printf ("You pressed %c\n", c); // print the character
  }
  resetCanonicalMode (); // switch back to canonical mode
  return 0;
}
